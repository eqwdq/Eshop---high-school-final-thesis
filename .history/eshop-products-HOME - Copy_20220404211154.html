<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Rubik:ital,wght@1,300&display=swap" rel="stylesheet">

	<!-- bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="test1.css">
    <link rel="icon" type="image/x-icon" href="https://octodex.github.com/images/swagtocat.png">
</head>
<body>

    <nav class="navbar">
        <div class="container">
            <ul class="nav me-auto my-2 my-lg-0">
                <a class="navbar-brand">Vaše Oblečenie</a>
                <li class="nav-item">
                    <a class="nav-link active" href="eshop-products-HOME - Copy.html">Domov</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="#">kontakt</a>
                </li>

                <li class="nav-item mx-1">
                    <a id="userlink" class="nav-link" href="#">Username</a>
                </li>

                <li class="nav-item mx-1">
                    <a id="signoutlink" class="nav-link" href="#">Sign out</a>
                </li>


            </ul>
        </div>
    </nav>

    <!-- start of carousel -->
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://firebasestorage.googleapis.com/v0/b/login-9a8b6.appspot.com/o/CarouselImages%2Fstock-photo-smiling-cheerful-funny-young-couple-two-friends-man-woman-s-wearing-white-pink-casual-hoodie-1879854031.jpg?alt=media&token=d8be081b-f787-46d7-873e-bfeb2c14ad2e" id="carouselImage1" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
                <img src="https://firebasestorage.googleapis.com/v0/b/login-9a8b6.appspot.com/o/CarouselImages%2Fstock-photo-young-curly-mature-man-wearing-an-elegant-shirt-being-shocked-because-of-something-she-has-seen-1639970746.jpg?alt=media&token=ba9b044d-f9a2-48a7-95c7-ad9a71e416f8" id="carouselImage2" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
                <img src="https://firebasestorage.googleapis.com/v0/b/login-9a8b6.appspot.com/o/CarouselImages%2Fstock-photo-full-length-body-size-girl-wearing-white-hoodie-jumping-up-with-backpack-isolated-pastel-pink-color-2015271203.jpg?alt=media&token=0dd86741-52ed-4e42-ad3f-746708fc93aa" id="carouselImage3" class="d-block w-100" alt="...">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <!-- end of carousel -->

    <section class="shop">
        <div id="productsDiv" class="row">

             <div class="row py-5">
                <div class="col-lg-8 m-auto text-center">
                    <h1>Produkty</h1>
                </div>
            </div>

        </div>
    </section>

    <!-- expanding shopping cart with offcanvas -->
    <div class="text-center">
        <button class="btn btn-primary defaultButton col-1 position-relative" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasCart" aria-controls="offcanvasScrolling">
        Košík
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="badge"></span>
        </button>
    </div>

    <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasCart" aria-labelledby="offcanvasCartLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasCartLabel">Nákupný Košík</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="cart-items">

            </div>
        </div>
        <div class="offcanvas-footer">
            <div class="cart-total">
                <strong class="cart-total-title">Total</strong>
                <span class="cart-total-price">0€</span>
                <button class="btn btn-outline-primary btn-md float-end btn-purchase">Kúpiť</button>
            </div>
        </div>
    </div>
<!--end of offcanvas-->


    <footer>
        <div class="container">
            <div class="contact-footer col-md-4">
                <h2>Kontakt</h2>
                <ul class="menu-item">
                    <li >
                        <a href="#"> O nás</a>
                    </li>
                    <li>
                        <a href="tel:0902 100 564"> 0902 100 564 </a>
                    </li>
                    <li>
                        <a href="https://www.google.sk/maps/place/Spojen%C3%A1+%C5%A1kola+(SP%C5%A0E+%C5%A0.+A.+Jedl%C3%ADka+a+Obchodn%C3%A1+akad%C3%A9mia)/@47.9841095,18.1683397,17z/data=!4m14!1m8!3m7!1s0x476b014df4bdf039:0x9b6e8c6cf777f147!2zU3BvamVuw6EgxaFrb2xhIChTUMWgRSDFoC4gQS4gSmVkbMOta2EgYSBPYmNob2Ruw6EgYWthZMOpbWlhKQ!8m2!3d47.984102!4d18.1705276!9m1!1b1!3m4!1s0x476b014df4bdf039:0x9b6e8c6cf777f147!8m2!3d47.984102!4d18.1705276" target="_blank"> Firma s.r.o
                    </a>
                    </li>
                    <li>
                        <h2>Pošlite nám správu</h2>
                        <a href="mailto::danielf0804@gmail.com"> email: danielf0804@gmail.com
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>



<script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-analytics.js";
    import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-storage.js";
    import { getDatabase, ref, get, set, child, update, remove } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-database.js";
    import { getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc  } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore.js";

    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCI5SdwdXMQeu3y7AQPZnkcZH_GmIcSgKw",
        authDomain: "login-9a8b6.firebaseapp.com",
        databaseURL: "https://login-9a8b6-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "login-9a8b6",
        storageBucket: "login-9a8b6.appspot.com",
        messagingSenderId: "663312681266",
        appId: "1:663312681266:web:aaff10c5e0a58994ceaf2b",
        measurementId: "G-XTC30ZEDBX"
    };


    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const realdb = getDatabase();
    const db = getFirestore();

    var outerDiv = document.getElementById('productsDiv');
    var arrayOfProducts = [];
    window.addEventListener('load',GetAllProducts);

    function GetAllProducts() {
        const dbref= ref(realdb);

        get(child(dbref, "ProductRealdb"))
        .then((snapshot) =>  {
            snapshot.forEach(prod => {
                arrayOfProducts.push(prod.val());
            });
            addAllProducts();
        })
    }

    function addAllProducts() {
        let i = 0;
        arrayOfProducts.forEach(prod => {
            addProduct(prod, i++)
        });
        assingAllEvent()
    }

    function addProduct(product, index) {
        let html =

        `
        <div class="card shadow-sm bg-light mb-2">
            <img src="`+ product.linksOfImagesArray +`" class="img-fluid shop-item-image thumb" id="thumb-`+ index +` alt="">
            <div class="card-body text-center">
                <h6 class="shop-item-title title detbtn" id="title-`+ index +`">`+ getShortTitle(product.ProductTitle) +`</h6>
                <p class="card-text" id="card-text">`+ getUl(product.Points) +`</p>
            </div>
            <div>
                <small class="text-muted float-start">`+ GenerateStockLabel(product.Stock) +`</small>
            </div>
            <div class="card-footer shop-item-details">
                <p class="float-start top shop-item-price" id="shop-item-price">`+ product.Price +` €</p>
                <button class="btn btn-outline-dark float-end shop-item-button ">Do košíka</button>
            </div>
        </div>
        `

        let newProd = document.createElement('div');
        newProd.classList.add('col-12', 'col-sm-6', 'col-xl-2', 'col-md-4', 'col-lg-3');
        newProd.innerHTML = html;
        outerDiv.append(newProd);

    }


    function GenerateStockLabel(stock) {
        let stocklabel = document.createElement('h6');
        stocklabel.classList.add('stock');

        if(stock > 0) {
            stocklabel.innerHTML = 'na sklade';
        }
        else {
            stocklabel.innerHTML = 'nie je na sklade';
            stocklabel.classList.add('text-warning');
        }
        return stocklabel.outerHTML;
    }

    function getUl(array) {
        let ul = document.createElement('ul');
        ul.classList.add('points');

        array.forEach(element => {
            let li = document.createElement('li')
            li.innerText = element;
            ul.append(li);
        });
        return ul.outerHTML;
    }

    function getShortTitle(title){
        if(title.lenght > 49) title = title.substring(0,47);
        else return title;
        return title + "..."
    }

    function getProductIndex(id) {
        var indstart = id.indexOf('-') + 1;
        var indend= id.lenght;
        return Number(id.substring(indstart,indend));
    }

    function goToProductDetails(event) {
        var index = getProductIndex(event.target.id);
        localStorage.product = JSON.stringify(arrayOfProducts[index]);
        window.location = "product_page_test - Copy.html"; // redirects to details page
    }

    function assingAllEvent() {
        var btns = document.getElementsByClassName('detbtn');
        var titles = document.getElementsByClassName('title');
        var thumbs = document.getElementsByClassName('thumb');

        for(let i = 0; i < btns.length; i++) {
            btns[i].addEventListener('click',goToProductDetails);
            titles[i].addEventListener('click',goToProductDetails);
            thumbs[i].addEventListener('click',goToProductDetails);
        }
    }

    //////////////////////////////// login

    let userlink = document.getElementById('userlink');
    let signoutlink = document.getElementById('signoutlink');
    let currentUser = null;

    function getUsername(){
        let keepLoggedIn = localStorage.getItem("keepLoggedIn");

        if(keepLoggedIn == "yes"){
            currentUser = JSON.parse(localStorage.getItem('user'))
        }
        else {
            currentUser = JSON.parse(sessionStorage.getItem('user'));
        }
    }
    signoutlink.addEventListener('click', signOut)
    function signOut() {
        sessionStorage.removeItem('user');
        localStorage.removeItem('user');
        localStorage.removeItem('keepLoggedIn');
        window.location = "eshop-products-HOME - Copy.html";
    }

    window.onload = function() {
        getUsername();
        if(currentUser == null){
            userlink.innerText = "Nový účet";
            userlink.classList.replace("nav-link", "btn");
            userlink.classList.add("btn-outline-primary");
            userlink.href = "register_test_new.html"

            signoutlink.innerText = "Prihlásiť sa";
            signoutlink.classList.replace("nav-link", "btn");
            signoutlink.classList.add("btn-outline-success");
            signoutlink.href = "login_test_new.html"
        }

        else {
            userlink.style.display = "none";

            signoutlink.innerText = "Odhlásiť sa";
            signoutlink.classList.replace("nav-link", "btn");
            signoutlink.classList.add("btn-outline-success");
            signoutlink.classList.add("btn");
            signoutlink.href = "javascript:Signout()";
        }
    }


</script>
<script src="main.js" async></script>
</body>
</html>